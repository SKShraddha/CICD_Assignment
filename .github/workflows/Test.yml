name: Docker Pull and Test

on :
    workflow_run:
        workflows: ["Create docker image and push"]
        types:
            - completed
        branches:
          - main
          - branch_test4

permissions:
  contents: read

jobs:
    Test:
        runs-on: ubuntu-latest
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        steps:
            - uses: actions/checkout@v3

            - name: Docker login
              uses: docker/login-action@v2
              with:
                username: ${{ secrets.DOCKER_USERNAME }}
                password: ${{ secrets.DOCKER_PASSWORD }}

            - name: Docker Pull
              run:
                docker pull ${{ secrets.DOCKER_USERNAME }}/cicd:v1

            - name: Docker Run
              run: |
                OUTPUT=$(docker run ${{ secrets.DOCKER_USERNAME }}/cicd:v1)
                echo "Score:"
                echo "$OUTPUT"
                if [[ `echo "$OUTPUT 0.50" | awk '{print ($1 < $2)}'` == 1 ]]; then echo "Insufficient Accuracy" && exit 1; fi
